#!/bin/bash

MQTT_BROKER="{{ mqtt_broker | default('localhost') }}"
MQTT_USER="{{ mqtt_user | default('') }}"
MQTT_PASS="{{ mqtt_pass | default('') }}"

{% for switch in switches %}
echo "Publishing for {{ switch.name }}..."

mosquitto_pub -h $MQTT_BROKER -t "{{ has_discover_sw }}/{{ switch.unique_id }}/config" \
{% if mqtt_user %} -u $MQTT_USER -P $MQTT_PASS {% endif %} \
-f output_{{ switch.unique_id }}.json

{% endfor %}
echo "All commands executed."

